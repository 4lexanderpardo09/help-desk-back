{
    "info": {
        "_postman_id": "help-desk-api-v1",
        "name": "Help Desk API",
        "description": "API REST del sistema Help Desk - Backend NestJS\n\n## Autenticación\nUsa JWT Bearer Token. Primero ejecuta el endpoint de login y copia el token en la variable `token`.\n\n## Variables\n- `base_url`: URL base del API (default: http://localhost:3000)\n- `token`: Token JWT obtenido del login",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string"
        },
        {
            "key": "token",
            "value": "",
            "type": "string"
        }
    ],
    "item": [
        {
            "name": "Auth",
            "description": "Endpoints de autenticación",
            "item": [
                {
                    "name": "Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Login exitoso', function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta contiene accessToken', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('accessToken');",
                                    "});",
                                    "",
                                    "// Guardar token automáticamente",
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.collectionVariables.set('token', jsonData.accessToken);",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"soportemesaayuda@gmail.com\",\n    \"password\": \"123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Autentica un usuario y retorna un token JWT.\n\n**Payload del Token:**\n- `usu_id`: ID del usuario\n- `usu_correo`: Email del usuario\n- `rol_id`: ID del rol\n- `reg_id`: ID de la regional\n- `car_id`: ID del cargo\n- `dp_id`: ID del departamento\n- `es_nacional`: Boolean si es usuario nacional"
                    },
                    "response": []
                },
                {
                    "name": "Login - Credenciales inválidas",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Retorna 401 Unauthorized', function () {",
                                    "    pm.response.to.have.status(401);",
                                    "});",
                                    "",
                                    "pm.test('Mensaje de error correcto', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.message).to.eql('Credenciales inválidas');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"usuario@invalido.com\",\n    \"password\": \"wrongpassword\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "login"
                            ]
                        },
                        "description": "Test de login con credenciales inválidas - debe retornar 401"
                    },
                    "response": []
                },
                {
                    "name": "Get Profile",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Perfil obtenido correctamente', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta contiene datos del usuario', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('usu_id');",
                                    "    pm.expect(jsonData).to.have.property('usu_correo');",
                                    "    pm.expect(jsonData).to.have.property('rol_id');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/auth/profile",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "auth",
                                "profile"
                            ]
                        },
                        "description": "Obtiene el perfil del usuario autenticado basado en el token JWT.\n\n**Requiere:** Token JWT válido"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Users",
            "description": "Gestión de usuarios (requiere autenticación)",
            "item": [
                {
                    "name": "Get All Users / Filter",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Lista de usuarios obtenida', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta es un array', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.be.an('array');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/users?includeDepartamento=true",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users"
                            ],
                            "query": [
                                {
                                    "key": "included",
                                    "value": "regional,regional.zona,cargo,departamento",
                                    "description": "Scopes: Incluir relaciones (separadas por coma)"
                                },
                                {
                                    "key": "filter[rolId]",
                                    "value": "2",
                                    "description": "Filtro dinámico por rol (ej: 2 = agentes)",
                                    "disabled": true
                                },
                                {
                                    "key": "filter[email]",
                                    "value": "",
                                    "description": "Filtro dinámico por email",
                                    "disabled": true
                                },
                                {
                                    "key": "filter[cargoId]",
                                    "value": "1",
                                    "description": "Filtro dinámico por cargo",
                                    "disabled": true
                                },
                                {
                                    "key": "zona",
                                    "value": "Norte",
                                    "description": "Filtrar por nombre de zona (Complex JOIN)",
                                    "disabled": true
                                },
                                {
                                    "key": "includeNacional",
                                    "value": "true",
                                    "description": "Incluir nacionales al filtrar por regional",
                                    "disabled": true
                                },
                                {
                                    "key": "included",
                                    "value": "regional,regional.zona,cargo,departamento",
                                    "description": "Scopes: Incluir relaciones (separadas por coma)",
                                    "disabled": true
                                },
                                {
                                    "key": "filter[email]",
                                    "value": "",
                                    "description": "Filtro dinámico por email",
                                    "disabled": true
                                },
                                {
                                    "key": "filter[nombre]",
                                    "value": "",
                                    "description": "Filtro dinámico por nombre",
                                    "disabled": true
                                }
                            ]
                        },
                        "description": " MASTER ENDPOINT. Obtiene todos los usuarios. Soporta múltiples filtros por query params (cargo, zona, regional, etc.)."
                    },
                    "response": []
                },
                {
                    "name": "Get User by ID",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Usuario obtenido correctamente', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/users/1",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1"
                            ]
                        },
                        "description": "Obtiene un usuario específico por su ID.\n\n**Requiere:** Token JWT válido"
                    },
                    "response": []
                },
                {
                    "name": "Create User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Usuario creado correctamente', function () {",
                                    "    pm.response.to.have.status(201);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta contiene ID del usuario', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('id');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"nombre\": \"Nuevo\",\n    \"apellido\": \"Usuario\",\n    \"email\": \"nuevo.usuario@example.com\",\n    \"password\": \"123456\",\n    \"rolId\": 2,\n    \"esNacional\": false,\n    \"regionalId\": 1,\n    \"cargoId\": 1,\n    \"departamentoId\": null,\n    \"cedula\": \"1234567890\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users"
                            ]
                        },
                        "description": "Crea un nuevo usuario en el sistema."
                    },
                    "response": []
                },
                {
                    "name": "Update User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Usuario actualizado correctamente', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta contiene datos actualizados', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('id');",
                                    "    pm.expect(jsonData).to.have.property('fechaModificacion');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"nombre\": \"Nombre Actualizado\",\n    \"apellido\": \"Apellido Actualizado\",\n    \"rolId\": 2\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/1",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1"
                            ]
                        },
                        "description": "Actualiza un usuario existente. Solo se actualizan los campos enviados."
                    },
                    "response": []
                },
                {
                    "name": "Delete User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Usuario eliminado correctamente', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Respuesta confirma eliminación', function () {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.deleted).to.be.true;",
                                    "    pm.expect(jsonData).to.have.property('id');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/users/1",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1"
                            ]
                        },
                        "description": "Elimina un usuario (soft delete). Marca estado = 0."
                    },
                    "response": []
                },
                {
                    "name": "Update Firma",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"firma\": \"path/to/firma.png\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/1/firma",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1",
                                "firma"
                            ]
                        },
                        "description": "Actualiza la firma de un usuario."
                    },
                    "response": []
                },
                {
                    "name": "Get Users by IDs",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"ids\": [1, 2, 3]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/by-ids",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "by-ids"
                            ]
                        },
                        "description": "Obtiene usuarios por lista de IDs con datos de regional."
                    },
                    "response": []
                },
                {
                    "name": "Sync User Perfiles",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"perfilIds\": [1, 2, 3]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/1/perfiles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1",
                                "perfiles"
                            ]
                        },
                        "description": "Sincroniza perfiles de un usuario. Elimina los existentes e inserta los nuevos."
                    },
                    "response": []
                },
                {
                    "name": "Get User Perfiles",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/users/1/perfiles",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "users",
                                "1",
                                "perfiles"
                            ]
                        },
                        "description": "Obtiene los perfiles asignados a un usuario."
                    },
                    "response": []
                }
            ]
        }
    ]
}